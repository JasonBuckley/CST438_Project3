{{>nav}}

<html>
<head>
    <title>Register</title>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <script src="https://code.jquery.com/jquery-3.5.0.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <link rel='stylesheet' type='text/css' href='https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css'>
    <link rel='stylesheet' href='/stylesheets/login.css' />
</head>

<body>


    <div class='container'>
        <div class='jumbotron'>
            <h1> Register Page  </h1> <br><br>

            <form id="registerForm" action="/user/add" method='POST'>
                <div class='form-group row'>
                    <div class='col-sm-4'></div>
                    <div class='col-sm-4'>
                        <input type='text' placeholder="Email" class='field shadow' id='email' name='email' required>
                    </div>
                </div>

                <div class='form-group row'>
                    <div class='col-sm-4'></div>
                    <div class='col-sm-4'>
                        <input type='text' placeholder="Username" class='field shadow' id='username' name='username' required>
                    </div>
                </div>

                <div class='form-group row'>
                    <div class='col-sm-4'></div>
                    <div class='col-sm-4'>
                        <input type='password' placeholder="Password" class='field shadow' id='password' name='password' required>
                    </div>
                </div>
                <div class='form-group row'>
                    <div class='col-sm-4'></div>
                    <div class='col-sm-4'>
                        <br>
                        <p style="color:red;"> <span id="errorMessage"></span>{{feedback}} </p>
                    </div>
                </div>

                <div class='form-group row'>
                    <div class='col-sm-4'></div>
                    <div class='col-sm-4'>
                        <button class='cool btn btn-primary btn-block' type="submit">
                            Register
                        </button>
                    </div>
                </div>

                <div class='form-group row'>
                    <div class='col-sm-4'></div>
                    <div class='col-sm-4'>
                        <p>Or click <a href="/user/login">here </a>  to log in.</p>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        $("#registerForm").on('submit', function (event) {
            event.preventDefault();
            let registerForm = $("#registerForm");

            $.ajax({
                type: registerForm.attr("method"),
                url: registerForm.attr("action"),
                data: registerForm.serialize(),
                success: function (results, status) {
                    $("#errorMessage").html("");
                    console.log(results);
                    if (results.success) {
                        window.location = window.location.origin + "/user/login?feedback=" + results.feedback
                    } else {
                        $("#errorMessage").html(results.feedback).attr("color", 'red');
                    }
                }
            });
        })
    </script>
</body >
</html >
